<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventori Pro - Sistem Manajemen Barang</title>
    <!-- WPOcean CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@wpocean/kit@1.0.0/dist/css/wpocean.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --sidebar-width: 250px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            color: #333;
            overflow-x: hidden;
        }
        
        /* Loading Screen */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255,255,255,0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .loading-text {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 18px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            color: white;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h3 {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 1.5rem;
        }
        
        .sidebar-header p {
            opacity: 0.8;
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        .nav-menu {
            padding: 20px 0;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-left-color: rgba(255,255,255,0.3);
        }
        
        .nav-link.active {
            background-color: rgba(255,255,255,0.15);
            color: white;
            border-left-color: white;
            font-weight: 600;
        }
        
        .nav-icon {
            width: 24px;
            text-align: center;
            margin-right: 12px;
            font-size: 1.1rem;
        }
        
        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 1.2rem;
        }
        
        .user-details h6 {
            margin-bottom: 2px;
            font-size: 0.9rem;
        }
        
        .user-details small {
            opacity: 0.7;
            font-size: 0.8rem;
        }
        
        .btn-logout {
            width: 100%;
            background-color: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .btn-logout:hover {
            background-color: rgba(255,255,255,0.2);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .page-title {
            color: var(--secondary-color);
            font-weight: 700;
            font-size: 1.8rem;
            position: relative;
            padding-bottom: 10px;
        }
        
        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }
        
        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .date-display {
            background-color: white;
            padding: 8px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .user-dropdown .btn {
            background-color: white;
            border: 1px solid #e0e0e0;
            color: var(--dark-color);
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .user-dropdown .dropdown-menu {
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-top: 10px;
        }
        
        /* Dashboard */
        .dashboard-header {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.3;
        }
        
        .dashboard-header h2 {
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .dashboard-header p {
            opacity: 0.9;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary-color);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .stat-card.success {
            border-left-color: var(--success-color);
        }
        
        .stat-card.info {
            border-left-color: var(--info-color);
        }
        
        .stat-card.warning {
            border-left-color: var(--warning-color);
        }
        
        .stat-card.danger {
            border-left-color: var(--danger-color);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        .stat-card .stat-icon {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }
        
        .stat-card.success .stat-icon {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }
        
        .stat-card.info .stat-icon {
            background-color: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
        }
        
        .stat-card.warning .stat-icon {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }
        
        .stat-card.danger .stat-icon {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .dashboard-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 992px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
        }
        
        .content-card {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e0e0e0;
            background-color: #f8f9fa;
        }
        
        .card-header h5 {
            margin-bottom: 0;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .card-body {
            padding: 25px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Tables */
        .table-container {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            background-color: #f1f5fd;
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            padding: 15px;
            white-space: nowrap;
        }
        
        .table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-color: #eef2f7;
        }
        
        .table tbody tr:hover {
            background-color: rgba(67, 97, 238, 0.03);
        }
        
        .badge {
            padding: 6px 12px;
            font-weight: 500;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .badge-stok-tinggi {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }
        
        .badge-stok-sedang {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }
        
        .badge-stok-rendah {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .btn-action {
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        /* Buttons */
        .btn {
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .btn-info {
            background-color: var(--info-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-outline-primary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background-color: transparent;
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .quick-action-btn {
            display: flex;
            align-items: center;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            text-decoration: none;
            color: var(--dark-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .quick-action-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background-color: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-right: 15px;
        }
        
        .quick-action-content h6 {
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .quick-action-content p {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0;
        }
        
        /* Modals */
        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .modal-header {
            border-bottom: 1px solid #e0e0e0;
            padding: 25px;
        }
        
        .modal-title {
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            border-top: 1px solid #e0e0e0;
            padding: 20px 25px;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.15);
        }
        
        .input-group-text {
            background-color: #f8f9fa;
            border: 2px solid #e0e0e0;
            color: #6c757d;
        }
        
        .form-text {
            font-size: 0.85rem;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 350px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
            
            .top-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .top-bar-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-responsive {
                margin: 0 -15px;
                padding: 0 15px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
        
        /* Mobile Toggle */
        .mobile-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        @media (max-width: 768px) {
            .mobile-toggle {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">Memuat aplikasi...</div>
    </div>
    
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle" id="mobileToggle">
        <i class="fas fa-bars"></i>
    </button>
    
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-boxes me-2"></i>Inventori Pro</h3>
                <p>Sistem Manajemen Barang</p>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item">
                    <a class="nav-link active" href="#" data-page="dashboard">
                        <div class="nav-icon"><i class="fas fa-home"></i></div>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" href="#" data-page="stok">
                        <div class="nav-icon"><i class="fas fa-box"></i></div>
                        <span>Stok Barang</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" href="#" data-page="produk">
                        <div class="nav-icon"><i class="fas fa-list"></i></div>
                        <span>Daftar Produk</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" href="#" data-page="barang-masuk">
                        <div class="nav-icon"><i class="fas fa-arrow-down"></i></div>
                        <span>Barang Masuk</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" href="#" data-page="barang-keluar">
                        <div class="nav-icon"><i class="fas fa-arrow-up"></i></div>
                        <span>Barang Keluar</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" href="#" data-page="laporan">
                        <div class="nav-icon"><i class="fas fa-chart-bar"></i></div>
                        <span>Laporan</span>
                    </a>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <h6 id="userName">Administrator</h6>
                        <small id="userRole">Super Admin</small>
                    </div>
                </div>
                <button class="btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </button>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Top Bar -->
            <div class="top-bar">
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <div class="top-bar-actions">
                    <div class="date-display" id="currentDate">
                        Senin, 1 Januari 2024
                    </div>
                    <div class="user-dropdown">
                        <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-2"></i>
                            <span id="userEmail">admin@inventori.com</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> Profil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Pengaturan</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" id="logoutBtn2"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Page Content -->
            <div id="pageContent">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <div class="dashboard-header">
                        <h2>Selamat Datang di Sistem Inventori</h2>
                        <p>Kelola stok, barang masuk, dan barang keluar dengan mudah dan efisien</p>
                    </div>
                    
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-value" id="totalProduk">0</div>
                            <div class="stat-label">Total Produk</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-icon">
                                <i class="fas fa-cubes"></i>
                            </div>
                            <div class="stat-value" id="totalStok">0</div>
                            <div class="stat-label">Total Stok (pcs)</div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-icon">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="stat-value" id="barangMasukBulan">0</div>
                            <div class="stat-label">Barang Masuk (Bulan)</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-icon">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="stat-value" id="barangKeluarBulan">0</div>
                            <div class="stat-label">Barang Keluar (Bulan)</div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div class="dashboard-content">
                        <!-- Left Column -->
                        <div>
                            <div class="content-card">
                                <div class="card-header">
                                    <h5><i class="fas fa-exclamation-triangle me-2 text-warning"></i>Stok Rendah</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="tableStokRendah">
                                            <thead>
                                                <tr>
                                                    <th>Nama Produk</th>
                                                    <th>SKU</th>
                                                    <th>Stok (pcs)</th>
                                                    <th>Status</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data akan dimuat via JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div>
                            <div class="content-card">
                                <div class="card-header">
                                    <h5><i class="fas fa-bolt me-2 text-primary"></i>Aksi Cepat</h5>
                                </div>
                                <div class="card-body">
                                    <div class="quick-actions">
                                        <a href="#" class="quick-action-btn" id="tambahProdukBtn">
                                            <div class="quick-action-icon">
                                                <i class="fas fa-plus"></i>
                                            </div>
                                            <div class="quick-action-content">
                                                <h6>Tambah Produk Baru</h6>
                                                <p>Tambah produk baru ke inventori</p>
                                            </div>
                                        </a>
                                        <a href="#" class="quick-action-btn" id="tambahBarangMasukBtn">
                                            <div class="quick-action-icon">
                                                <i class="fas fa-arrow-down"></i>
                                            </div>
                                            <div class="quick-action-content">
                                                <h6>Barang Masuk</h6>
                                                <p>Catat barang yang masuk ke gudang</p>
                                            </div>
                                        </a>
                                        <a href="#" class="quick-action-btn" id="tambahBarangKeluarBtn">
                                            <div class="quick-action-icon">
                                                <i class="fas fa-arrow-up"></i>
                                            </div>
                                            <div class="quick-action-content">
                                                <h6>Barang Keluar</h6>
                                                <p>Catat barang yang keluar dari gudang</p>
                                            </div>
                                        </a>
                                        <a href="#" class="quick-action-btn" id="generateLaporanBtn">
                                            <div class="quick-action-icon">
                                                <i class="fas fa-file-alt"></i>
                                            </div>
                                            <div class="quick-action-content">
                                                <h6>Generate Laporan</h6>
                                                <p>Buat laporan periode tertentu</p>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stok Barang Page -->
                <div id="stokPage" class="page-content" style="display: none;">
                    <div class="content-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-box me-2"></i>Stok Saat Ini</h5>
                            <div>
                                <button class="btn btn-primary" id="refreshStokBtn">
                                    <i class="fas fa-sync-alt me-2"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="tableStok">
                                    <thead>
                                        <tr>
                                            <th>Nama Produk</th>
                                            <th>SKU</th>
                                            <th>Unit Besar</th>
                                            <th>Unit Kecil</th>
                                            <th>Stok Total (pcs)</th>
                                            <th>Status</th>
                                            <th>Terakhir Diperbarui</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Daftar Produk Page -->
                <div id="produkPage" class="page-content" style="display: none;">
                    <div class="content-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-list me-2"></i>Daftar Produk</h5>
                            <button class="btn btn-primary" id="tambahProdukBtn2">
                                <i class="fas fa-plus me-2"></i> Tambah Produk
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="tableProduk">
                                    <thead>
                                        <tr>
                                            <th>Nama Produk</th>
                                            <th>SKU</th>
                                            <th>Deskripsi</th>
                                            <th>Unit Besar</th>
                                            <th>Unit Kecil</th>
                                            <th>Konversi</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Barang Masuk Page -->
                <div id="barangMasukPage" class="page-content" style="display: none;">
                    <div class="content-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-arrow-down me-2"></i>Barang Masuk</h5>
                            <button class="btn btn-primary" id="tambahBarangMasukBtn2">
                                <i class="fas fa-plus me-2"></i> Tambah Barang Masuk
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="tableBarangMasuk">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Produk</th>
                                            <th>Jumlah (Unit Besar)</th>
                                            <th>Sumber</th>
                                            <th>Catatan</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Barang Keluar Page -->
                <div id="barangKeluarPage" class="page-content" style="display: none;">
                    <div class="content-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-arrow-up me-2"></i>Barang Keluar</h5>
                            <button class="btn btn-primary" id="tambahBarangKeluarBtn2">
                                <i class="fas fa-plus me-2"></i> Tambah Barang Keluar
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="tableBarangKeluar">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Produk</th>
                                            <th>Jumlah (Unit Kecil)</th>
                                            <th>Tujuan</th>
                                            <th>Catatan</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Laporan Page -->
                <div id="laporanPage" class="page-content" style="display: none;">
                    <div class="content-card">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-bar me-2"></i>Laporan Inventori</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <label for="laporanPeriode" class="form-label">Pilih Periode</label>
                                    <select class="form-select" id="laporanPeriode">
                                        <option value="hari-ini">Hari Ini</option>
                                        <option value="minggu-ini">Minggu Ini</option>
                                        <option value="bulan-ini" selected>Bulan Ini</option>
                                        <option value="tahun-ini">Tahun Ini</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                                <div class="col-md-6" id="customDateRange" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="tanggalAwal" class="form-label">Tanggal Awal</label>
                                            <input type="date" class="form-control" id="tanggalAwal">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="tanggalAkhir" class="form-label">Tanggal Akhir</label>
                                            <input type="date" class="form-control" id="tanggalAkhir">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 align-self-end">
                                    <button class="btn btn-primary w-100" id="generateLaporanBtn2">
                                        <i class="fas fa-chart-bar me-2"></i> Generate Laporan
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="content-card">
                                        <div class="card-header">
                                            <h6>Ringkasan Laporan</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="ringkasanLaporan" class="empty-state">
                                                <i class="fas fa-file-alt"></i>
                                                <p>Pilih periode dan generate laporan</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="content-card">
                                        <div class="card-header">
                                            <h6>Produk dengan Pergerakan Tertinggi</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="pergerakanProduk" class="empty-state">
                                                <i class="fas fa-chart-line"></i>
                                                <p>Data akan tampil setelah generate laporan</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modal Tambah Produk -->
    <div class="modal fade" id="modalTambahProduk" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus-circle me-2"></i>Tambah Produk Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="formTambahProduk">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="namaProduk" class="form-label">Nama Produk <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="namaProduk" required
                                           placeholder="Contoh: Susu Kaleng 250ml">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sku" class="form-label">SKU (Kode Produk) <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="sku" required
                                           placeholder="Contoh: SKU-001">
                                    <div class="form-text">Kode unik untuk identifikasi produk</div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="deskripsiProduk" class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="deskripsiProduk" rows="3"
                                      placeholder="Deskripsi singkat produk"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="unitBesar" class="form-label">Unit Besar <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="unitBesar" required
                                           placeholder="Karton, Pak, Dus">
                                    <div class="form-text">Satuan pembelian grosir</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="unitKecil" class="form-label">Unit Kecil <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="unitKecil" required
                                           placeholder="Pcs, Botol, Sachet">
                                    <div class="form-text">Satuan penjualan eceran</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="konversiKecil" class="form-label">Konversi <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text">1</span>
                                        <input type="number" class="form-control" id="konversiKecil" 
                                               min="1" value="1" required>
                                        <span class="input-group-text" id="konversiLabel">Unit Kecil</span>
                                    </div>
                                    <div class="form-text">
                                        1 <span id="unitBesarPreview">Unit Besar</span> = 
                                        <span id="konversiPreview" class="fw-bold text-primary">1</span> 
                                        <span id="unitKecilPreview">Unit Kecil</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Batal
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Simpan Produk
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Tambah Barang Masuk -->
    <div class="modal fade" id="modalTambahBarangMasuk" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-arrow-down me-2"></i>Tambah Barang Masuk</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="formTambahBarangMasuk">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="produkMasuk" class="form-label">Produk <span class="text-danger">*</span></label>
                            <select class="form-select" id="produkMasuk" required>
                                <option value="">Pilih Produk...</option>
                            </select>
                            <div class="form-text" id="produkInfoMasuk"></div>
                        </div>
                        <div class="mb-3">
                            <label for="jumlahUnitBesar" class="form-label">Jumlah (Unit Besar) <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="jumlahUnitBesar" min="1" required>
                                <span class="input-group-text" id="unitBesarLabelMasuk">Unit</span>
                            </div>
                            <div class="form-text">
                                Setara dengan <span id="konversiInfoMasuk" class="fw-bold">0</span> unit kecil
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="tanggalMasuk" class="form-label">Tanggal Masuk <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="tanggalMasuk" required>
                        </div>
                        <div class="mb-3">
                            <label for="sumber" class="form-label">Sumber</label>
                            <input type="text" class="form-control" id="sumber" 
                                   placeholder="Contoh: Supplier ABC, Pembelian, Retur">
                        </div>
                        <div class="mb-3">
                            <label for="catatanMasuk" class="form-label">Catatan</label>
                            <textarea class="form-control" id="catatanMasuk" rows="3"
                                      placeholder="Catatan tambahan..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Batal
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check me-2"></i>Simpan Barang Masuk
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Tambah Barang Keluar -->
    <div class="modal fade" id="modalTambahBarangKeluar" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-arrow-up me-2"></i>Tambah Barang Keluar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="formTambahBarangKeluar">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="produkKeluar" class="form-label">Produk <span class="text-danger">*</span></label>
                            <select class="form-select" id="produkKeluar" required>
                                <option value="">Pilih Produk...</option>
                            </select>
                            <div class="form-text" id="produkInfoKeluar"></div>
                        </div>
                        <div class="mb-3">
                            <label for="jumlahUnitKecil" class="form-label">Jumlah (Unit Kecil) <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="jumlahUnitKecil" min="1" required>
                                <span class="input-group-text" id="unitKecilLabelKeluar">pcs</span>
                            </div>
                            <div class="alert alert-info mt-2 py-2" id="stokInfoBox">
                                <i class="fas fa-info-circle me-2"></i>
                                Stok tersedia: <strong id="stokTersedia">0</strong> pcs
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="tanggalKeluar" class="form-label">Tanggal Keluar <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="tanggalKeluar" required>
                        </div>
                        <div class="mb-3">
                            <label for="tujuan" class="form-label">Tujuan</label>
                            <input type="text" class="form-control" id="tujuan" 
                                   placeholder="Contoh: Toko XYZ, Penjualan, Sample">
                        </div>
                        <div class="mb-3">
                            <label for="catatanKeluar" class="form-label">Catatan</label>
                            <textarea class="form-control" id="catatanKeluar" rows="3"
                                      placeholder="Catatan tambahan..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Batal
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check me-2"></i>Simpan Barang Keluar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // Konfigurasi Supabase
        const SUPABASE_URL = 'https://iltqolfmvhzaiuagtoxt.supabase.co'; // Ganti dengan URL Supabase Anda
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlsdHFvbGZtdmh6YWl1YWd0b3h0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNDE5MjQsImV4cCI6MjA4MDgxNzkyNH0.sGzEQjpKfy7fdw8KBNO7mVzKd2tuxqQaYAdRuTjHVMs'; // Ganti dengan anon key Supabase Anda
        
        // Variabel global
        let supabase;
        let currentPage = 'dashboard';
        
        // Inisialisasi aplikasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        async function initApp() {
            // Tampilkan loading screen
            showLoading(true, 'Memuat aplikasi...');
            
            try {
                // Set tanggal hari ini
                updateCurrentDate();
                
                // Inisialisasi Supabase
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // Setup event listeners
                setupEventListeners();
                
                // Inisialisasi preview konversi
                updateKonversiPreview();
                
                // Set tanggal default untuk form
                setDefaultDates();
                
                // Tampilkan dashboard pertama kali
                showPage('dashboard');
                
                // Muat data awal
                await initDataLoaders();
                
                showNotification('Sistem inventori siap digunakan!', 'success');
                
            } catch (error) {
                console.error('Failed to initialize app:', error);
                showNotification('Gagal memuat data awal. Periksa koneksi database.', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', options);
        }
        
        function setupEventListeners() {
            // Navigasi sidebar
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    
                    // Update active state
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Tampilkan halaman yang dipilih
                    showPage(page);
                    
                    // Tutup sidebar di mobile
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
            
            // Mobile toggle
            document.getElementById('mobileToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });
            
            // Tombol logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('logoutBtn2').addEventListener('click', logout);
            
            // Tombol aksi cepat di dashboard
            document.getElementById('tambahProdukBtn').addEventListener('click', () => {
                showModal('modalTambahProduk');
            });
            
            document.getElementById('tambahBarangMasukBtn').addEventListener('click', () => {
                showModal('modalTambahBarangMasuk');
            });
            
            document.getElementById('tambahBarangKeluarBtn').addEventListener('click', () => {
                showModal('modalTambahBarangKeluar');
                updateStokInfo();
            });
            
            document.getElementById('generateLaporanBtn').addEventListener('click', () => {
                showPage('laporan');
            });
            
            // Tombol di halaman produk
            document.getElementById('tambahProdukBtn2').addEventListener('click', () => {
                showModal('modalTambahProduk');
            });
            
            // Tombol di halaman barang masuk
            document.getElementById('tambahBarangMasukBtn2').addEventListener('click', () => {
                showModal('modalTambahBarangMasuk');
            });
            
            // Tombol di halaman barang keluar
            document.getElementById('tambahBarangKeluarBtn2').addEventListener('click', () => {
                showModal('modalTambahBarangKeluar');
                updateStokInfo();
            });
            
            // Tombol refresh stok
            document.getElementById('refreshStokBtn').addEventListener('click', loadStokData);
            
            // Tombol generate laporan
            document.getElementById('generateLaporanBtn2').addEventListener('click', generateLaporan);
            
            // Pilihan periode laporan
            document.getElementById('laporanPeriode').addEventListener('change', function() {
                const customRange = document.getElementById('customDateRange');
                if (this.value === 'custom') {
                    customRange.style.display = 'block';
                } else {
                    customRange.style.display = 'none';
                }
            });
            
            // Form tambah produk
            document.getElementById('formTambahProduk').addEventListener('submit', async function(e) {
                e.preventDefault();
                await tambahProduk();
            });
            
            // Form tambah barang masuk
            document.getElementById('formTambahBarangMasuk').addEventListener('submit', async function(e) {
                e.preventDefault();
                await tambahBarangMasuk();
            });
            
            // Form tambah barang keluar
            document.getElementById('formTambahBarangKeluar').addEventListener('submit', async function(e) {
                e.preventDefault();
                await tambahBarangKeluar();
            });
            
            // Event untuk update preview konversi
            document.getElementById('unitBesar').addEventListener('input', updateKonversiPreview);
            document.getElementById('unitKecil').addEventListener('input', updateKonversiPreview);
            document.getElementById('konversiKecil').addEventListener('input', updateKonversiPreview);
            
            // Event untuk update info produk saat pilihan berubah
            document.getElementById('produkMasuk').addEventListener('change', updateProdukInfoMasuk);
            document.getElementById('produkKeluar').addEventListener('change', updateProdukInfoKeluar);
            
            // Event untuk validasi jumlah barang keluar
            document.getElementById('jumlahUnitKecil').addEventListener('input', validateStokKeluar);
            
            // Event untuk update konversi saat jumlah berubah (barang masuk)
            document.getElementById('jumlahUnitBesar').addEventListener('input', function() {
                updateKonversiMasuk();
            });
        }
        
        async function initDataLoaders() {
            // Load data awal secara paralel
            await Promise.all([
                loadDashboardData(),
                loadProdukOptions(),
                loadStokData()
            ]);
        }
        
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalMasuk').value = today;
            document.getElementById('tanggalKeluar').value = today;
            document.getElementById('tanggalAwal').value = today;
            document.getElementById('tanggalAkhir').value = today;
        }
        
        function showPage(pageName) {
            // Sembunyikan semua halaman
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Tampilkan halaman yang dipilih
            document.getElementById(pageName + 'Page').style.display = 'block';
            
            // Update judul halaman
            const pageTitles = {
                'dashboard': 'Dashboard',
                'stok': 'Stok Barang',
                'produk': 'Daftar Produk',
                'barang-masuk': 'Barang Masuk',
                'barang-keluar': 'Barang Keluar',
                'laporan': 'Laporan'
            };
            
            document.getElementById('pageTitle').textContent = pageTitles[pageName];
            
            // Muat data halaman yang dipilih
            currentPage = pageName;
            
            switch(pageName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'stok':
                    loadStokData();
                    break;
                case 'produk':
                    loadProdukData();
                    break;
                case 'barang-masuk':
                    loadBarangMasukData();
                    break;
                case 'barang-keluar':
                    loadBarangKeluarData();
                    break;
                case 'laporan':
                    generateLaporan();
                    break;
            }
        }
        
        function showModal(modalId) {
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            modal.show();
        }
        
        // Fungsi update preview konversi
        function updateKonversiPreview() {
            const unitBesar = document.getElementById('unitBesar').value || 'Unit Besar';
            const unitKecil = document.getElementById('unitKecil').value || 'Unit Kecil';
            const konversi = document.getElementById('konversiKecil').value || '1';
            
            document.getElementById('unitBesarPreview').textContent = unitBesar;
            document.getElementById('unitKecilPreview').textContent = unitKecil;
            document.getElementById('konversiPreview').textContent = konversi;
            document.getElementById('konversiLabel').textContent = unitKecil;
        }
        
        // Fungsi update info produk di modal barang masuk
        function updateProdukInfoMasuk() {
            const select = document.getElementById('produkMasuk');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                const konversi = selectedOption.getAttribute('data-konversi') || '1';
                const unitBesar = selectedOption.getAttribute('data-unit-besar') || 'Unit';
                const unitKecil = selectedOption.getAttribute('data-unit-kecil') || 'pcs';
                
                document.getElementById('unitBesarLabelMasuk').textContent = unitBesar;
                document.getElementById('produkInfoMasuk').textContent = `1 ${unitBesar} = ${konversi} ${unitKecil}`;
                
                // Update konversi
                updateKonversiMasuk();
            } else {
                document.getElementById('unitBesarLabelMasuk').textContent = 'Unit';
                document.getElementById('produkInfoMasuk').textContent = '';
                document.getElementById('konversiInfoMasuk').textContent = '0';
            }
        }
        
        function updateKonversiMasuk() {
            const select = document.getElementById('produkMasuk');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                const konversi = parseInt(selectedOption.getAttribute('data-konversi')) || 1;
                const jumlah = parseInt(document.getElementById('jumlahUnitBesar').value) || 0;
                const totalKecil = jumlah * konversi;
                document.getElementById('konversiInfoMasuk').textContent = totalKecil;
            }
        }
        
        // Fungsi update info produk di modal barang keluar
        async function updateProdukInfoKeluar() {
            const select = document.getElementById('produkKeluar');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                const unitKecil = selectedOption.getAttribute('data-unit-kecil') || 'pcs';
                document.getElementById('unitKecilLabelKeluar').textContent = unitKecil;
                document.getElementById('produkInfoKeluar').textContent = `Satuan: ${unitKecil}`;
                
                // Update info stok
                await updateStokInfo();
            } else {
                document.getElementById('unitKecilLabelKeluar').textContent = 'pcs';
                document.getElementById('produkInfoKeluar').textContent = '';
                document.getElementById('stokInfoBox').innerHTML = 
                    `<i class="fas fa-info-circle me-2"></i>Pilih produk terlebih dahulu`;
            }
        }
        
        // Fungsi validasi stok barang keluar
        function validateStokKeluar() {
            const jumlah = parseInt(document.getElementById('jumlahUnitKecil').value) || 0;
            const stokTersedia = parseInt(document.getElementById('stokTersedia').textContent) || 0;
            
            if (jumlah > stokTersedia) {
                document.getElementById('stokInfoBox').className = 'alert alert-danger mt-2 py-2';
                document.getElementById('stokInfoBox').innerHTML = 
                    `<i class="fas fa-exclamation-triangle me-2"></i>
                     Stok tidak cukup! Permintaan: ${jumlah} pcs, Stok tersedia: ${stokTersedia} pcs`;
                return false;
            } else {
                document.getElementById('stokInfoBox').className = 'alert alert-info mt-2 py-2';
                document.getElementById('stokInfoBox').innerHTML = 
                    `<i class="fas fa-info-circle me-2"></i>
                     Stok tersedia: <strong>${stokTersedia}</strong> pcs`;
                return true;
            }
        }
        
        async function loadDashboardData() {
            showLoading(true, 'Memuat data dashboard...');
            
            try {
                // Hitung total produk
                const { count: totalProduk } = await supabase
                    .from('produk')
                    .select('*', { count: 'exact', head: true });
                
                document.getElementById('totalProduk').textContent = totalProduk || 0;
                
                // Hitung total stok
                const { data: stokData, error: stokError } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('stok_total_pcs');
                
                let totalStok = 0;
                if (stokData) {
                    totalStok = stokData.reduce((sum, item) => sum + (item.stok_total_pcs || 0), 0);
                }
                
                document.getElementById('totalStok').textContent = totalStok;
                
                // Hitung barang masuk bulan ini
                const now = new Date();
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                
                const { data: barangMasukBulan, error: errorMasuk } = await supabase
                    .from('barang_masuk')
                    .select('jumlah_unit_besar')
                    .gte('tanggal_masuk', firstDay.toISOString().split('T')[0])
                    .lte('tanggal_masuk', lastDay.toISOString().split('T')[0]);
                
                let totalMasuk = 0;
                if (barangMasukBulan) {
                    totalMasuk = barangMasukBulan.reduce((sum, item) => sum + (item.jumlah_unit_besar || 0), 0);
                }
                
                document.getElementById('barangMasukBulan').textContent = totalMasuk;
                
                // Hitung barang keluar bulan ini
                const { data: barangKeluarBulan, error: errorKeluar } = await supabase
                    .from('barang_keluar')
                    .select('jumlah_unit_kecil')
                    .gte('tanggal_keluar', firstDay.toISOString().split('T')[0])
                    .lte('tanggal_keluar', lastDay.toISOString().split('T')[0]);
                
                let totalKeluar = 0;
                if (barangKeluarBulan) {
                    totalKeluar = barangKeluarBulan.reduce((sum, item) => sum + (item.jumlah_unit_kecil || 0), 0);
                }
                
                document.getElementById('barangKeluarBulan').textContent = totalKeluar;
                
                // Tampilkan stok rendah
                await loadStokRendah();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Terjadi kesalahan saat memuat data dashboard', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadStokRendah() {
            try {
                const { data, error } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('*')
                    .lt('stok_total_pcs', 20)
                    .order('stok_total_pcs', { ascending: true })
                    .limit(10);
                
                const tbody = document.querySelector('#tableStokRendah tbody');
                tbody.innerHTML = '';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const status = getStokStatus(item.stok_total_pcs);
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.nama_produk}</td>
                            <td><span class="badge bg-secondary">${item.sku}</span></td>
                            <td><strong>${item.stok_total_pcs}</strong> ${item.unit_kecil}</td>
                            <td><span class="badge ${status.class}">${status.text}</span></td>
                            <td>
                                <button class="btn btn-sm btn-success" onclick="tambahBarangMasukForProduct(${item.produk_id})" title="Tambah Stok">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center text-muted py-4">
                                <i class="fas fa-check-circle fa-2x mb-2 text-success"></i>
                                <p>Tidak ada stok rendah</p>
                                <small class="text-muted">Semua produk memiliki stok cukup</small>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading low stock:', error);
                const tbody = document.querySelector('#tableStokRendah tbody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-danger py-4">
                            <i class="fas fa-exclamation-circle fa-2x mb-2"></i>
                            <p>Gagal memuat data stok</p>
                            <small>${error.message}</small>
                        </td>
                    </tr>
                `;
            }
        }
        
        async function loadStokData() {
            showLoading(true, 'Memuat data stok...');
            
            try {
                const { data, error } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('*')
                    .order('nama_produk');
                
                const tbody = document.querySelector('#tableStok tbody');
                tbody.innerHTML = '';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const status = getStokStatus(item.stok_total_pcs);
                        const lastUpdated = new Date(item.last_updated).toLocaleDateString('id-ID');
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.nama_produk}</td>
                            <td><span class="badge bg-secondary">${item.sku}</span></td>
                            <td>${item.unit_besar}</td>
                            <td>${item.unit_kecil}</td>
                            <td><strong>${item.stok_total_pcs}</strong></td>
                            <td><span class="badge ${status.class}">${status.text}</span></td>
                            <td>${lastUpdated}</td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                <i class="fas fa-box-open fa-2x mb-2"></i>
                                <p>Belum ada data stok</p>
                                <small class="text-muted">Tambah produk dan barang masuk terlebih dahulu</small>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading stock data:', error);
                showNotification('Terjadi kesalahan saat memuat data stok', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadProdukData() {
            showLoading(true, 'Memuat data produk...');
            
            try {
                const { data, error } = await supabase
                    .from('produk')
                    .select('*')
                    .order('nama_produk');
                
                const tbody = document.querySelector('#tableProduk tbody');
                tbody.innerHTML = '';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.nama_produk}</td>
                            <td><span class="badge bg-primary">${item.sku}</span></td>
                            <td>${item.deskripsi || '-'}</td>
                            <td>${item.unit_besar}</td>
                            <td>${item.unit_kecil}</td>
                            <td>1 ${item.unit_besar} = ${item.konversi_kecil} ${item.unit_kecil}</td>
                            <td class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary btn-action" onclick="editProduk(${item.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger btn-action" onclick="hapusProduk(${item.id})" title="Hapus">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                <i class="fas fa-list-alt fa-2x mb-2"></i>
                                <p>Belum ada data produk</p>
                                <small class="text-muted">Tambah produk baru untuk memulai</small>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading product data:', error);
                showNotification('Terjadi kesalahan saat memuat data produk', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadBarangMasukData() {
            showLoading(true, 'Memuat data barang masuk...');
            
            try {
                const { data: barangMasuk, error } = await supabase
                    .from('barang_masuk')
                    .select('*')
                    .order('tanggal_masuk', { ascending: false });
                
                const tbody = document.querySelector('#tableBarangMasuk tbody');
                tbody.innerHTML = '';
                
                if (barangMasuk && barangMasuk.length > 0) {
                    for (const item of barangMasuk) {
                        // Ambil info produk
                        const { data: produkData } = await supabase
                            .from('produk')
                            .select('nama_produk')
                            .eq('id', item.produk_id)
                            .single();
                        
                        const tanggal = new Date(item.tanggal_masuk).toLocaleDateString('id-ID');
                        const namaProduk = produkData ? produkData.nama_produk : 'Unknown';
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${tanggal}</td>
                            <td>${namaProduk}</td>
                            <td><strong>${item.jumlah_unit_besar}</strong></td>
                            <td>${item.sumber || '-'}</td>
                            <td>${item.catatan || '-'}</td>
                            <td class="action-buttons">
                                <button class="btn btn-sm btn-outline-danger btn-action" onclick="hapusBarangMasuk(${item.id})" title="Hapus">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                <i class="fas fa-arrow-down fa-2x mb-2"></i>
                                <p>Belum ada data barang masuk</p>
                                <small class="text-muted">Tambah barang masuk untuk memulai</small>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading incoming goods data:', error);
                showNotification('Terjadi kesalahan saat memuat data barang masuk', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadBarangKeluarData() {
            showLoading(true, 'Memuat data barang keluar...');
            
            try {
                const { data: barangKeluar, error } = await supabase
                    .from('barang_keluar')
                    .select('*')
                    .order('tanggal_keluar', { ascending: false });
                
                const tbody = document.querySelector('#tableBarangKeluar tbody');
                tbody.innerHTML = '';
                
                if (barangKeluar && barangKeluar.length > 0) {
                    for (const item of barangKeluar) {
                        // Ambil info produk
                        const { data: produkData } = await supabase
                            .from('produk')
                            .select('nama_produk')
                            .eq('id', item.produk_id)
                            .single();
                        
                        const tanggal = new Date(item.tanggal_keluar).toLocaleDateString('id-ID');
                        const namaProduk = produkData ? produkData.nama_produk : 'Unknown';
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${tanggal}</td>
                            <td>${namaProduk}</td>
                            <td><strong>${item.jumlah_unit_kecil}</strong></td>
                            <td>${item.tujuan || '-'}</td>
                            <td>${item.catatan || '-'}</td>
                            <td class="action-buttons">
                                <button class="btn btn-sm btn-outline-danger btn-action" onclick="hapusBarangKeluar(${item.id})" title="Hapus">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                <i class="fas fa-arrow-up fa-2x mb-2"></i>
                                <p>Belum ada data barang keluar</p>
                                <small class="text-muted">Tambah barang keluar untuk memulai</small>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading outgoing goods data:', error);
                showNotification('Terjadi kesalahan saat memuat data barang keluar', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadProdukOptions() {
            try {
                const { data, error } = await supabase
                    .from('produk')
                    .select('id, nama_produk, sku, konversi_kecil, unit_besar, unit_kecil')
                    .order('nama_produk');
                
                const selectMasuk = document.getElementById('produkMasuk');
                const selectKeluar = document.getElementById('produkKeluar');
                
                // Clear dan tambahkan opsi default
                selectMasuk.innerHTML = '<option value="">Pilih Produk...</option>';
                selectKeluar.innerHTML = '<option value="">Pilih Produk...</option>';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const optionMasuk = document.createElement('option');
                        optionMasuk.value = item.id;
                        optionMasuk.textContent = `${item.nama_produk} (${item.sku})`;
                        optionMasuk.setAttribute('data-konversi', item.konversi_kecil);
                        optionMasuk.setAttribute('data-unit-besar', item.unit_besar);
                        optionMasuk.setAttribute('data-unit-kecil', item.unit_kecil);
                        
                        const optionKeluar = document.createElement('option');
                        optionKeluar.value = item.id;
                        optionKeluar.textContent = `${item.nama_produk} (${item.sku})`;
                        optionKeluar.setAttribute('data-konversi', item.konversi_kecil);
                        optionKeluar.setAttribute('data-unit-besar', item.unit_besar);
                        optionKeluar.setAttribute('data-unit-kecil', item.unit_kecil);
                        
                        selectMasuk.appendChild(optionMasuk);
                        selectKeluar.appendChild(optionKeluar);
                    });
                    
                    // Update info stok untuk opsi produk
                    await updateAllProductStockInfo();
                } else {
                    // Tambahkan pesan jika tidak ada produk
                    const option = document.createElement('option');
                    option.value = "";
                    option.textContent = "Belum ada produk - Tambah produk terlebih dahulu";
                    selectMasuk.appendChild(option.cloneNode(true));
                    selectKeluar.appendChild(option);
                }
            } catch (error) {
                console.error('Error loading product options:', error);
                showNotification('Error memuat data produk', 'error');
            }
        }
        
        // Fungsi untuk update info stok semua produk
        async function updateAllProductStockInfo() {
            try {
                const { data: stokData, error } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('produk_id, stok_total_pcs');
                
                if (stokData) {
                    const selectKeluar = document.getElementById('produkKeluar');
                    const options = selectKeluar.options;
                    
                    for (let i = 0; i < options.length; i++) {
                        const option = options[i];
                        if (option.value) {
                            const stokItem = stokData.find(item => item.produk_id == option.value);
                            const stok = stokItem ? stokItem.stok_total_pcs : 0;
                            
                            // Tambahkan info stok ke teks opsi
                            const originalText = option.textContent;
                            option.textContent = `${originalText} - Stok: ${stok} pcs`;
                        }
                    }
                }
            } catch (error) {
                console.error('Error updating stock info:', error);
            }
        }
        
        async function updateStokInfo() {
            const produkId = document.getElementById('produkKeluar').value;
            
            if (!produkId) {
                document.getElementById('stokTersedia').textContent = '0';
                document.getElementById('stokInfoBox').innerHTML = 
                    `<i class="fas fa-info-circle me-2"></i>Pilih produk terlebih dahulu`;
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('stok_total_pcs')
                    .eq('produk_id', produkId)
                    .single();
                
                if (data) {
                    const stok = data.stok_total_pcs || 0;
                    document.getElementById('stokTersedia').textContent = stok;
                    
                    // Update stok info box
                    if (stok <= 10) {
                        document.getElementById('stokInfoBox').className = 'alert alert-warning mt-2 py-2';
                        document.getElementById('stokInfoBox').innerHTML = 
                            `<i class="fas fa-exclamation-triangle me-2"></i>
                             Stok rendah! Tersedia: <strong>${stok}</strong> pcs`;
                    } else {
                        document.getElementById('stokInfoBox').className = 'alert alert-info mt-2 py-2';
                        document.getElementById('stokInfoBox').innerHTML = 
                            `<i class="fas fa-check-circle me-2"></i>
                             Stok tersedia: <strong>${stok}</strong> pcs`;
                    }
                } else {
                    document.getElementById('stokTersedia').textContent = '0';
                    document.getElementById('stokInfoBox').innerHTML = 
                        `<i class="fas fa-info-circle me-2"></i>Stok tidak ditemukan`;
                }
            } catch (error) {
                console.error('Error loading stock info:', error);
                document.getElementById('stokTersedia').textContent = '0';
                document.getElementById('stokInfoBox').innerHTML = 
                    `<i class="fas fa-exclamation-circle me-2"></i>Error memuat stok`;
            }
        }
        
        async function tambahProduk() {
            showLoading(true, 'Menyimpan produk...');
            
            const produkData = {
                nama_produk: document.getElementById('namaProduk').value,
                sku: document.getElementById('sku').value,
                deskripsi: document.getElementById('deskripsiProduk').value,
                unit_besar: document.getElementById('unitBesar').value,
                unit_kecil: document.getElementById('unitKecil').value,
                konversi_kecil: parseInt(document.getElementById('konversiKecil').value)
            };
            
            try {
                const { data, error } = await supabase
                    .from('produk')
                    .insert([produkData]);
                
                if (error) throw error;
                
                // Tutup modal dan reset form
                bootstrap.Modal.getInstance(document.getElementById('modalTambahProduk')).hide();
                document.getElementById('formTambahProduk').reset();
                
                // Refresh data
                if (currentPage === 'produk') {
                    loadProdukData();
                } else if (currentPage === 'dashboard') {
                    loadDashboardData();
                }
                
                // Refresh opsi produk
                loadProdukOptions();
                
                showNotification('Produk berhasil ditambahkan!', 'success');
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('Terjadi kesalahan saat menambahkan produk', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function tambahBarangMasuk() {
            showLoading(true, 'Menyimpan barang masuk...');
            
            const barangMasukData = {
                produk_id: parseInt(document.getElementById('produkMasuk').value),
                jumlah_unit_besar: parseInt(document.getElementById('jumlahUnitBesar').value),
                tanggal_masuk: document.getElementById('tanggalMasuk').value,
                sumber: document.getElementById('sumber').value || null,
                catatan: document.getElementById('catatanMasuk').value || null
            };
            
            try {
                const { data, error } = await supabase
                    .from('barang_masuk')
                    .insert([barangMasukData]);
                
                if (error) throw error;
                
                // Tutup modal dan reset form
                bootstrap.Modal.getInstance(document.getElementById('modalTambahBarangMasuk')).hide();
                document.getElementById('formTambahBarangMasuk').reset();
                
                // Refresh data
                if (currentPage === 'barang-masuk') {
                    loadBarangMasukData();
                } else if (currentPage === 'dashboard') {
                    loadDashboardData();
                }
                
                // Refresh stok info
                if (currentPage === 'stok') {
                    loadStokData();
                }
                
                showNotification('Barang masuk berhasil dicatat!', 'success');
            } catch (error) {
                console.error('Error adding incoming goods:', error);
                showNotification('Terjadi kesalahan saat mencatat barang masuk', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function tambahBarangKeluar() {
            // Validasi stok terlebih dahulu
            if (!validateStokKeluar()) {
                showNotification('Stok tidak cukup untuk melakukan transaksi ini', 'error');
                return;
            }
            
            showLoading(true, 'Menyimpan barang keluar...');
            
            const barangKeluarData = {
                produk_id: parseInt(document.getElementById('produkKeluar').value),
                jumlah_unit_kecil: parseInt(document.getElementById('jumlahUnitKecil').value),
                tanggal_keluar: document.getElementById('tanggalKeluar').value,
                tujuan: document.getElementById('tujuan').value || null,
                catatan: document.getElementById('catatanKeluar').value || null
            };
            
            try {
                const { data, error } = await supabase
                    .from('barang_keluar')
                    .insert([barangKeluarData]);
                
                if (error) throw error;
                
                // Tutup modal dan reset form
                bootstrap.Modal.getInstance(document.getElementById('modalTambahBarangKeluar')).hide();
                document.getElementById('formTambahBarangKeluar').reset();
                
                // Refresh data
                if (currentPage === 'barang-keluar') {
                    loadBarangKeluarData();
                } else if (currentPage === 'dashboard') {
                    loadDashboardData();
                }
                
                // Refresh stok info
                if (currentPage === 'stok') {
                    loadStokData();
                }
                
                showNotification('Barang keluar berhasil dicatat!', 'success');
            } catch (error) {
                console.error('Error adding outgoing goods:', error);
                showNotification('Terjadi kesalahan saat mencatat barang keluar', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function generateLaporan() {
            showLoading(true, 'Membuat laporan...');
            
            try {
                // Tentukan periode
                let startDate, endDate;
                const now = new Date();
                const periode = document.getElementById('laporanPeriode').value;
                
                switch(periode) {
                    case 'hari-ini':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                        break;
                    case 'minggu-ini':
                        const day = now.getDay();
                        const diff = now.getDate() - day + (day === 0 ? -6 : 1);
                        startDate = new Date(now.getFullYear(), now.getMonth(), diff);
                        endDate = new Date(now.getFullYear(), now.getMonth(), diff + 7);
                        break;
                    case 'bulan-ini':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                        break;
                    case 'tahun-ini':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        endDate = new Date(now.getFullYear() + 1, 0, 0);
                        break;
                    case 'custom':
                        startDate = new Date(document.getElementById('tanggalAwal').value);
                        endDate = new Date(document.getElementById('tanggalAkhir').value);
                        break;
                }
                
                // Format tanggal untuk query
                const startDateStr = startDate.toISOString().split('T')[0];
                const endDateStr = endDate.toISOString().split('T')[0];
                
                // Ambil data barang masuk
                const { data: barangMasuk, error: errorMasuk } = await supabase
                    .from('barang_masuk')
                    .select('*, produk(nama_produk, sku)')
                    .gte('tanggal_masuk', startDateStr)
                    .lte('tanggal_masuk', endDateStr);
                
                // Ambil data barang keluar
                const { data: barangKeluar, error: errorKeluar } = await supabase
                    .from('barang_keluar')
                    .select('*, produk(nama_produk, sku)')
                    .gte('tanggal_keluar', startDateStr)
                    .lte('tanggal_keluar', endDateStr);
                
                // Hitung ringkasan
                let totalMasuk = 0;
                let totalKeluar = 0;
                let totalNilaiMasuk = 0;
                let totalNilaiKeluar = 0;
                
                if (barangMasuk) {
                    totalMasuk = barangMasuk.reduce((sum, item) => sum + (item.jumlah_unit_besar || 0), 0);
                }
                
                if (barangKeluar) {
                    totalKeluar = barangKeluar.reduce((sum, item) => sum + (item.jumlah_unit_kecil || 0), 0);
                }
                
                // Tampilkan ringkasan
                const ringkasanHTML = `
                    <div>
                        <div class="mb-4">
                            <h6 class="text-primary">Ringkasan Laporan</h6>
                            <p class="mb-2">Periode: ${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}</p>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light mb-3">
                                    <div class="card-body">
                                        <h6 class="card-title">Barang Masuk</h6>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h2 class="mb-0 text-success">${totalMasuk}</h2>
                                                <small class="text-muted">Unit Besar</small>
                                            </div>
                                            <div class="text-end">
                                                <p class="mb-0">${barangMasuk?.length || 0} transaksi</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light mb-3">
                                    <div class="card-body">
                                        <h6 class="card-title">Barang Keluar</h6>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h2 class="mb-0 text-warning">${totalKeluar}</h2>
                                                <small class="text-muted">Unit Kecil</small>
                                            </div>
                                            <div class="text-end">
                                                <p class="mb-0">${barangKeluar?.length || 0} transaksi</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-end mt-3">
                            <button class="btn btn-sm btn-outline-primary" onclick="exportLaporan()">
                                <i class="fas fa-download me-2"></i> Export Laporan
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('ringkasanLaporan').innerHTML = ringkasanHTML;
                
                // Tampilkan produk dengan pergerakan tertinggi
                // Analisis sederhana: hitung total pergerakan per produk
                const produkPergerakan = {};
                
                if (barangMasuk) {
                    barangMasuk.forEach(item => {
                        const produkId = item.produk_id;
                        if (!produkPergerakan[produkId]) {
                            produkPergerakan[produkId] = {
                                nama: item.produk?.nama_produk || 'Unknown',
                                masuk: 0,
                                keluar: 0
                            };
                        }
                        produkPergerakan[produkId].masuk += item.jumlah_unit_besar;
                    });
                }
                
                if (barangKeluar) {
                    barangKeluar.forEach(item => {
                        const produkId = item.produk_id;
                        if (!produkPergerakan[produkId]) {
                            produkPergerakan[produkId] = {
                                nama: item.produk?.nama_produk || 'Unknown',
                                masuk: 0,
                                keluar: 0
                            };
                        }
                        produkPergerakan[produkId].keluar += item.jumlah_unit_kecil;
                    });
                }
                
                // Urutkan berdasarkan total pergerakan
                const sortedProduk = Object.values(produkPergerakan)
                    .sort((a, b) => (b.masuk + b.keluar) - (a.masuk + a.keluar))
                    .slice(0, 5);
                
                let pergerakanHTML = '<h6 class="mb-3">Top 5 Produk dengan Pergerakan Tertinggi</h6>';
                
                if (sortedProduk.length > 0) {
                    sortedProduk.forEach((produk, index) => {
                        pergerakanHTML += `
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold">${index + 1}. ${produk.nama}</span>
                                    <span class="badge bg-primary">${produk.masuk + produk.keluar} unit</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success" style="width: ${(produk.masuk / (produk.masuk + produk.keluar)) * 100}%" 
                                         title="Masuk: ${produk.masuk}"></div>
                                    <div class="progress-bar bg-warning" style="width: ${(produk.keluar / (produk.masuk + produk.keluar)) * 100}%" 
                                         title="Keluar: ${produk.keluar}"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-1">
                                    <small class="text-success"><i class="fas fa-arrow-down me-1"></i> ${produk.masuk}</small>
                                    <small class="text-warning"><i class="fas fa-arrow-up me-1"></i> ${produk.keluar}</small>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    pergerakanHTML = `
                        <div class="text-center text-muted py-3">
                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                            <p>Tidak ada data pergerakan pada periode ini</p>
                        </div>
                    `;
                }
                
                document.getElementById('pergerakanProduk').innerHTML = pergerakanHTML;
                
                showNotification('Laporan berhasil dibuat!', 'success');
                
            } catch (error) {
                console.error('Error generating report:', error);
                showNotification('Terjadi kesalahan saat membuat laporan', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        function getStokStatus(stok) {
            if (stok >= 100) {
                return { class: 'badge-stok-tinggi', text: 'Tinggi' };
            } else if (stok >= 20) {
                return { class: 'badge-stok-sedang', text: 'Sedang' };
            } else {
                return { class: 'badge-stok-rendah', text: 'Rendah' };
            }
        }
        
        function showLoading(show, message = '') {
            const loading = document.getElementById('loading');
            const loadingText = loading.querySelector('.loading-text');
            
            if (message) {
                loadingText.textContent = message;
            }
            
            if (show) {
                loading.classList.add('active');
            } else {
                loading.classList.remove('active');
            }
        }
        
        function showNotification(message, type = 'info') {
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';
            
            const icon = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle'
            }[type] || 'fas fa-info-circle';
            
            const alert = document.createElement('div');
            alert.className = `alert ${alertClass} alert-dismissible fade show notification`;
            alert.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="${icon} me-2"></i>
                    <div class="flex-grow-1">${message}</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.body.appendChild(alert);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
        
        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                window.location.href = 'index.html';
            }
        }
        
        // Fungsi untuk tombol aksi di tabel
        async function tambahBarangMasukForProduct(produkId) {
            document.getElementById('produkMasuk').value = produkId;
            showModal('modalTambahBarangMasuk');
        }
        
        async function editProduk(id) {
            // Implementasi edit produk
            showNotification('Fitur edit produk akan segera tersedia', 'info');
        }
        
        async function hapusProduk(id) {
            if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                showLoading(true, 'Menghapus produk...');
                
                try {
                    const { error } = await supabase
                        .from('produk')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    loadProdukData();
                    loadProdukOptions();
                    loadDashboardData();
                    
                    showNotification('Produk berhasil dihapus', 'success');
                } catch (error) {
                    console.error('Error deleting product:', error);
                    showNotification('Terjadi kesalahan saat menghapus produk', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        async function hapusBarangMasuk(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data barang masuk ini?')) {
                showLoading(true, 'Menghapus data barang masuk...');
                
                try {
                    const { error } = await supabase
                        .from('barang_masuk')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    loadBarangMasukData();
                    loadDashboardData();
                    
                    showNotification('Data barang masuk berhasil dihapus', 'success');
                } catch (error) {
                    console.error('Error deleting incoming goods:', error);
                    showNotification('Terjadi kesalahan saat menghapus data barang masuk', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        async function hapusBarangKeluar(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data barang keluar ini?')) {
                showLoading(true, 'Menghapus data barang keluar...');
                
                try {
                    const { error } = await supabase
                        .from('barang_keluar')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    loadBarangKeluarData();
                    loadDashboardData();
                    
                    showNotification('Data barang keluar berhasil dihapus', 'success');
                } catch (error) {
                    console.error('Error deleting outgoing goods:', error);
                    showNotification('Terjadi kesalahan saat menghapus data barang keluar', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        function exportLaporan() {
            showNotification('Fitur export laporan akan segera tersedia', 'info');
            // Implementasi: Generate PDF atau Excel dari data laporan
        }
        
        // Handle window resize untuk mobile
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        });
    </script>
</body>
</html>
