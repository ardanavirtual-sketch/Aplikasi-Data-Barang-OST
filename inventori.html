<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventori Pro - Sistem Manajemen Barang</title>
    <!-- WPOcean CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@wpocean/kit@1.0.0/dist/css/wpocean.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --light-color: #f8f9fa;
            --dark-color: #212529;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: none;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .badge-stok {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .stok-tinggi { background-color: #d4edda; color: #155724; }
        .stok-sedang { background-color: #fff3cd; color: #856404; }
        .stok-rendah { background-color: #f8d7da; color: #721c24; }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            min-height: 100vh;
            color: white;
        }
        
        .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            margin: 5px 0;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .stat-card {
            border-left: 5px solid var(--primary-color);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .dashboard-header {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255,255,255,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .action-buttons .btn {
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .page-title {
            color: var(--secondary-color);
            font-weight: 700;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>
    
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse p-0">
                <div class="position-sticky pt-3">
                    <div class="text-center p-4">
                        <h3><i class="fas fa-boxes me-2"></i>Inventori Pro</h3>
                        <p class="text-light opacity-75">Sistem Manajemen Barang</p>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-page="dashboard">
                                <i class="fas fa-home me-2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="stok">
                                <i class="fas fa-box me-2"></i> Stok Barang
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="produk">
                                <i class="fas fa-list me-2"></i> Daftar Produk
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="barang-masuk">
                                <i class="fas fa-arrow-down me-2"></i> Barang Masuk
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="barang-keluar">
                                <i class="fas fa-arrow-up me-2"></i> Barang Keluar
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="laporan">
                                <i class="fas fa-chart-bar me-2"></i> Laporan
                            </a>
                        </li>
                    </ul>
                    
                    <div class="position-absolute bottom-0 w-100 p-3">
                        <div class="text-center">
                            <button class="btn btn-outline-light w-100 mb-2" id="logoutBtn">
                                <i class="fas fa-sign-out-alt me-2"></i> Logout
                            </button>
                            <small class="text-light opacity-75">v1.0.0</small>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <span id="currentDate"></span>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-2"></i> <span id="userEmail">Admin</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Pengaturan</a></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn2"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Dashboard Content -->
                <div id="dashboardPage" class="page-content">
                    <div class="dashboard-header">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2>Selamat Datang di Sistem Inventori</h2>
                                <p class="mb-0">Kelola stok, barang masuk, dan barang keluar dengan mudah dan efisien</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <i class="fas fa-warehouse fa-4x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h5 class="card-title text-muted">Total Produk</h5>
                                            <h2 id="totalProduk">0</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-boxes fa-2x text-primary"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h5 class="card-title text-muted">Total Stok</h5>
                                            <h2 id="totalStok">0</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-cubes fa-2x text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h5 class="card-title text-muted">Barang Masuk (Bulan)</h5>
                                            <h2 id="barangMasukBulan">0</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-arrow-down fa-2x text-info"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h5 class="card-title text-muted">Barang Keluar (Bulan)</h5>
                                            <h2 id="barangKeluarBulan">0</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-arrow-up fa-2x text-warning"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Stok Rendah</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="tableStokRendah">
                                            <thead>
                                                <tr>
                                                    <th>Nama Produk</th>
                                                    <th>SKU</th>
                                                    <th>Stok (pcs)</th>
                                                    <th>Status</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data akan dimuat via JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Aksi Cepat</h5>
                                </div>
                                <div class="card-body">
                                    <button class="btn btn-primary w-100 mb-3" id="tambahProdukBtn">
                                        <i class="fas fa-plus me-2"></i> Tambah Produk Baru
                                    </button>
                                    <button class="btn btn-success w-100 mb-3" id="tambahBarangMasukBtn">
                                        <i class="fas fa-arrow-down me-2"></i> Barang Masuk
                                    </button>
                                    <button class="btn btn-warning w-100 mb-3" id="tambahBarangKeluarBtn">
                                        <i class="fas fa-arrow-up me-2"></i> Barang Keluar
                                    </button>
                                    <button class="btn btn-info w-100" id="generateLaporanBtn">
                                        <i class="fas fa-file-alt me-2"></i> Generate Laporan
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stok Barang Page -->
                <div id="stokPage" class="page-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Stok Saat Ini</h5>
                            <div>
                                <button class="btn btn-primary" id="refreshStokBtn">
                                    <i class="fas fa-sync-alt me-2"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="tableStok">
                                    <thead>
                                        <tr>
                                            <th>Nama Produk</th>
                                            <th>SKU</th>
                                            <th>Unit Besar</th>
                                            <th>Unit Kecil</th>
                                            <th>Stok Total (pcs)</th>
                                            <th>Status</th>
                                            <th>Terakhir Diperbarui</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Daftar Produk Page -->
                <div id="produkPage" class="page-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Daftar Produk</h5>
                            <button class="btn btn-primary" id="tambahProdukBtn2">
                                <i class="fas fa-plus me-2"></i> Tambah Produk
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="tableProduk">
                                    <thead>
                                        <tr>
                                            <th>Nama Produk</th>
                                            <th>SKU</th>
                                            <th>Deskripsi</th>
                                            <th>Unit Besar</th>
                                            <th>Unit Kecil</th>
                                            <th>Konversi</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Barang Masuk Page -->
                <div id="barangMasukPage" class="page-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Barang Masuk</h5>
                            <button class="btn btn-primary" id="tambahBarangMasukBtn2">
                                <i class="fas fa-plus me-2"></i> Tambah Barang Masuk
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="tableBarangMasuk">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Produk</th>
                                            <th>Jumlah (Unit Besar)</th>
                                            <th>Sumber</th>
                                            <th>Catatan</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Barang Keluar Page -->
                <div id="barangKeluarPage" class="page-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Barang Keluar</h5>
                            <button class="btn btn-primary" id="tambahBarangKeluarBtn2">
                                <i class="fas fa-plus me-2"></i> Tambah Barang Keluar
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="tableBarangKeluar">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Produk</th>
                                            <th>Jumlah (Unit Kecil)</th>
                                            <th>Tujuan</th>
                                            <th>Catatan</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan dimuat via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Laporan Page -->
                <div id="laporanPage" class="page-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Laporan Inventori</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <label for="laporanPeriode">Pilih Periode</label>
                                    <select class="form-select" id="laporanPeriode">
                                        <option value="hari-ini">Hari Ini</option>
                                        <option value="minggu-ini">Minggu Ini</option>
                                        <option value="bulan-ini" selected>Bulan Ini</option>
                                        <option value="tahun-ini">Tahun Ini</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                                <div class="col-md-3" id="customDateRange" style="display: none;">
                                    <label for="tanggalAwal">Tanggal Awal</label>
                                    <input type="date" class="form-control" id="tanggalAwal">
                                    <label for="tanggalAkhir" class="mt-2">Tanggal Akhir</label>
                                    <input type="date" class="form-control" id="tanggalAkhir">
                                </div>
                                <div class="col-md-3 align-self-end">
                                    <button class="btn btn-primary" id="generateLaporanBtn2">
                                        <i class="fas fa-chart-bar me-2"></i> Generate Laporan
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6>Ringkasan Laporan</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="ringkasanLaporan">
                                                <!-- Ringkasan laporan akan ditampilkan di sini -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6>Produk dengan Pergerakan Tertinggi</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="pergerakanProduk">
                                                <!-- Data pergerakan produk akan ditampilkan di sini -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modal Tambah Produk -->
    <div class="modal fade" id="modalTambahProduk" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Produk Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formTambahProduk">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="namaProduk" class="form-label">Nama Produk *</label>
                                    <input type="text" class="form-control" id="namaProduk" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sku" class="form-label">SKU *</label>
                                    <input type="text" class="form-control" id="sku" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="deskripsiProduk" class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="deskripsiProduk" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="unitBesar" class="form-label">Unit Besar *</label>
                                    <input type="text" class="form-control" id="unitBesar" required>
                                    <small class="text-muted">Contoh: Karton, Pak, Dus</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="unitKecil" class="form-label">Unit Kecil *</label>
                                    <input type="text" class="form-control" id="unitKecil" required>
                                    <small class="text-muted">Contoh: Pcs, Botol, Sachet</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="konversiKecil" class="form-label">Konversi *</label>
                                    <input type="number" class="form-control" id="konversiKecil" min="1" value="1" required>
                                    <small class="text-muted">1 Unit Besar = ? Unit Kecil</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Produk</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Tambah Barang Masuk -->
    <div class="modal fade" id="modalTambahBarangMasuk" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Barang Masuk</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formTambahBarangMasuk">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="produkMasuk" class="form-label">Produk *</label>
                            <select class="form-select" id="produkMasuk" required>
                                <option value="">Pilih Produk</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="jumlahUnitBesar" class="form-label">Jumlah (Unit Besar) *</label>
                            <input type="number" class="form-control" id="jumlahUnitBesar" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="tanggalMasuk" class="form-label">Tanggal Masuk *</label>
                            <input type="date" class="form-control" id="tanggalMasuk" required>
                        </div>
                        <div class="mb-3">
                            <label for="sumber" class="form-label">Sumber</label>
                            <input type="text" class="form-control" id="sumber">
                        </div>
                        <div class="mb-3">
                            <label for="catatanMasuk" class="form-label">Catatan</label>
                            <textarea class="form-control" id="catatanMasuk" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Barang Masuk</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Tambah Barang Keluar -->
    <div class="modal fade" id="modalTambahBarangKeluar" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Barang Keluar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formTambahBarangKeluar">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="produkKeluar" class="form-label">Produk *</label>
                            <select class="form-select" id="produkKeluar" required>
                                <option value="">Pilih Produk</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="jumlahUnitKecil" class="form-label">Jumlah (Unit Kecil) *</label>
                            <input type="number" class="form-control" id="jumlahUnitKecil" min="1" required>
                            <small class="text-muted">Stok tersedia: <span id="stokTersedia">0</span> pcs</small>
                        </div>
                        <div class="mb-3">
                            <label for="tanggalKeluar" class="form-label">Tanggal Keluar *</label>
                            <input type="date" class="form-control" id="tanggalKeluar" required>
                        </div>
                        <div class="mb-3">
                            <label for="tujuan" class="form-label">Tujuan</label>
                            <input type="text" class="form-control" id="tujuan">
                        </div>
                        <div class="mb-3">
                            <label for="catatanKeluar" class="form-label">Catatan</label>
                            <textarea class="form-control" id="catatanKeluar" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Barang Keluar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Konfigurasi Supabase
        const SUPABASE_URL = 'https://your-project.supabase.co'; // Ganti dengan URL Supabase Anda
        const SUPABASE_KEY = 'your-anon-key'; // Ganti dengan anon key Supabase Anda
        
        let supabase;
        let currentPage = 'dashboard';
        
        // Inisialisasi aplikasi
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        async function initApp() {
            // Set tanggal hari ini
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Inisialisasi Supabase
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            // Setup event listeners
            setupEventListeners();
            
            // Tampilkan dashboard pertama kali
            showPage('dashboard');
            
            // Muat data awal
            loadDashboardData();
            loadProdukOptions();
        }
        
        function setupEventListeners() {
            // Navigasi sidebar
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    
                    // Update active state
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Tampilkan halaman yang dipilih
                    showPage(page);
                });
            });
            
            // Tombol logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('logoutBtn2').addEventListener('click', logout);
            
            // Tombol aksi cepat di dashboard
            document.getElementById('tambahProdukBtn').addEventListener('click', () => {
                showModal('modalTambahProduk');
            });
            
            document.getElementById('tambahBarangMasukBtn').addEventListener('click', () => {
                showModal('modalTambahBarangMasuk');
            });
            
            document.getElementById('tambahBarangKeluarBtn').addEventListener('click', () => {
                showModal('modalTambahBarangKeluar');
                updateStokInfo();
            });
            
            document.getElementById('generateLaporanBtn').addEventListener('click', () => {
                showPage('laporan');
            });
            
            // Tombol di halaman produk
            document.getElementById('tambahProdukBtn2').addEventListener('click', () => {
                showModal('modalTambahProduk');
            });
            
            // Tombol di halaman barang masuk
            document.getElementById('tambahBarangMasukBtn2').addEventListener('click', () => {
                showModal('modalTambahBarangMasuk');
            });
            
            // Tombol di halaman barang keluar
            document.getElementById('tambahBarangKeluarBtn2').addEventListener('click', () => {
                showModal('modalTambahBarangKeluar');
                updateStokInfo();
            });
            
            // Tombol refresh stok
            document.getElementById('refreshStokBtn').addEventListener('click', loadStokData);
            
            // Tombol generate laporan
            document.getElementById('generateLaporanBtn2').addEventListener('click', generateLaporan);
            
            // Pilihan periode laporan
            document.getElementById('laporanPeriode').addEventListener('change', function() {
                const customRange = document.getElementById('customDateRange');
                if (this.value === 'custom') {
                    customRange.style.display = 'block';
                } else {
                    customRange.style.display = 'none';
                }
            });
            
            // Form tambah produk
            document.getElementById('formTambahProduk').addEventListener('submit', async function(e) {
                e.preventDefault();
                await tambahProduk();
            });
            
            // Form tambah barang masuk
            document.getElementById('formTambahBarangMasuk').addEventListener('submit', async function(e) {
                e.preventDefault();
                await tambahBarangMasuk();
            });
            
            // Form tambah barang keluar
            document.getElementById('formTambahBarangKeluar').addEventListener('submit', async function(e) {
                e.preventDefault();
                await tambahBarangKeluar();
            });
            
            // Update info stok saat produk berubah
            document.getElementById('produkKeluar').addEventListener('change', updateStokInfo);
        }
        
        function showPage(pageName) {
            // Sembunyikan semua halaman
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Tampilkan halaman yang dipilih
            document.getElementById(pageName + 'Page').style.display = 'block';
            
            // Update judul halaman
            const pageTitles = {
                'dashboard': 'Dashboard',
                'stok': 'Stok Barang',
                'produk': 'Daftar Produk',
                'barang-masuk': 'Barang Masuk',
                'barang-keluar': 'Barang Keluar',
                'laporan': 'Laporan'
            };
            
            document.getElementById('pageTitle').textContent = pageTitles[pageName];
            
            // Muat data halaman yang dipilih
            currentPage = pageName;
            
            switch(pageName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'stok':
                    loadStokData();
                    break;
                case 'produk':
                    loadProdukData();
                    break;
                case 'barang-masuk':
                    loadBarangMasukData();
                    break;
                case 'barang-keluar':
                    loadBarangKeluarData();
                    break;
                case 'laporan':
                    generateLaporan();
                    break;
            }
        }
        
        function showModal(modalId) {
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            modal.show();
        }
        
        async function loadDashboardData() {
            showLoading(true);
            
            try {
                // Hitung total produk
                const { count: totalProduk } = await supabase
                    .from('produk')
                    .select('*', { count: 'exact', head: true });
                
                document.getElementById('totalProduk').textContent = totalProduk || 0;
                
                // Hitung total stok
                const { data: stokData, error: stokError } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('stok_total_pcs');
                
                let totalStok = 0;
                if (stokData) {
                    totalStok = stokData.reduce((sum, item) => sum + (item.stok_total_pcs || 0), 0);
                }
                
                document.getElementById('totalStok').textContent = totalStok;
                
                // Hitung barang masuk bulan ini
                const now = new Date();
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                
                const { data: barangMasukBulan, error: errorMasuk } = await supabase
                    .from('barang_masuk')
                    .select('jumlah_unit_besar')
                    .gte('tanggal_masuk', firstDay.toISOString().split('T')[0])
                    .lte('tanggal_masuk', lastDay.toISOString().split('T')[0]);
                
                let totalMasuk = 0;
                if (barangMasukBulan) {
                    totalMasuk = barangMasukBulan.reduce((sum, item) => sum + (item.jumlah_unit_besar || 0), 0);
                }
                
                document.getElementById('barangMasukBulan').textContent = totalMasuk;
                
                // Hitung barang keluar bulan ini
                const { data: barangKeluarBulan, error: errorKeluar } = await supabase
                    .from('barang_keluar')
                    .select('jumlah_unit_kecil')
                    .gte('tanggal_keluar', firstDay.toISOString().split('T')[0])
                    .lte('tanggal_keluar', lastDay.toISOString().split('T')[0]);
                
                let totalKeluar = 0;
                if (barangKeluarBulan) {
                    totalKeluar = barangKeluarBulan.reduce((sum, item) => sum + (item.jumlah_unit_kecil || 0), 0);
                }
                
                document.getElementById('barangKeluarBulan').textContent = totalKeluar;
                
                // Tampilkan stok rendah
                await loadStokRendah();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                alert('Terjadi kesalahan saat memuat data dashboard');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadStokRendah() {
            try {
                const { data, error } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('*')
                    .order('stok_total_pcs', { ascending: true })
                    .limit(5);
                
                const tbody = document.querySelector('#tableStokRendah tbody');
                tbody.innerHTML = '';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const status = getStokStatus(item.stok_total_pcs);
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.nama_produk}</td>
                            <td>${item.sku}</td>
                            <td>${item.stok_total_pcs}</td>
                            <td><span class="badge-stok ${status.class}">${status.text}</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="tambahBarangMasukForProduct(${item.produk_id})">
                                    <i class="fas fa-arrow-down"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">Tidak ada data stok rendah</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading low stock:', error);
            }
        }
        
        async function loadStokData() {
            showLoading(true);
            
            try {
                const { data, error } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('*')
                    .order('nama_produk');
                
                const tbody = document.querySelector('#tableStok tbody');
                tbody.innerHTML = '';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const status = getStokStatus(item.stok_total_pcs);
                        const lastUpdated = new Date(item.last_updated).toLocaleDateString('id-ID');
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.nama_produk}</td>
                            <td>${item.sku}</td>
                            <td>${item.unit_besar}</td>
                            <td>${item.unit_kecil}</td>
                            <td>${item.stok_total_pcs}</td>
                            <td><span class="badge-stok ${status.class}">${status.text}</span></td>
                            <td>${lastUpdated}</td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">Belum ada data stok</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading stock data:', error);
                alert('Terjadi kesalahan saat memuat data stok');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadProdukData() {
            showLoading(true);
            
            try {
                const { data, error } = await supabase
                    .from('produk')
                    .select('*')
                    .order('nama_produk');
                
                const tbody = document.querySelector('#tableProduk tbody');
                tbody.innerHTML = '';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.nama_produk}</td>
                            <td>${item.sku}</td>
                            <td>${item.deskripsi || '-'}</td>
                            <td>${item.unit_besar}</td>
                            <td>${item.unit_kecil}</td>
                            <td>1 ${item.unit_besar} = ${item.konversi_kecil} ${item.unit_kecil}</td>
                            <td class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary" onclick="editProduk(${item.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="hapusProduk(${item.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">Belum ada data produk</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading product data:', error);
                alert('Terjadi kesalahan saat memuat data produk');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadBarangMasukData() {
            showLoading(true);
            
            try {
                const { data, error } = await supabase
                    .from('barang_masuk')
                    .select(`
                        *,
                        produk:nama_produk
                    `)
                    .order('tanggal_masuk', { ascending: false });
                
                const tbody = document.querySelector('#tableBarangMasuk tbody');
                tbody.innerHTML = '';
                
                if (data && data.length > 0) {
                    // Catatan: Anda perlu menyesuaikan query join sesuai struktur database
                    // Contoh di atas mungkin perlu disesuaikan
                    
                    // Untuk sekarang, kita akan ambil data terpisah
                    const { data: barangMasuk, error: errorBM } = await supabase
                        .from('barang_masuk')
                        .select('*')
                        .order('tanggal_masuk', { ascending: false });
                    
                    if (barangMasuk) {
                        for (const item of barangMasuk) {
                            // Ambil info produk
                            const { data: produkData } = await supabase
                                .from('produk')
                                .select('nama_produk')
                                .eq('id', item.produk_id)
                                .single();
                            
                            const tanggal = new Date(item.tanggal_masuk).toLocaleDateString('id-ID');
                            const namaProduk = produkData ? produkData.nama_produk : 'Unknown';
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${tanggal}</td>
                                <td>${namaProduk}</td>
                                <td>${item.jumlah_unit_besar}</td>
                                <td>${item.sumber || '-'}</td>
                                <td>${item.catatan || '-'}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-danger" onclick="hapusBarangMasuk(${item.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        }
                    }
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">Belum ada data barang masuk</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading incoming goods data:', error);
                alert('Terjadi kesalahan saat memuat data barang masuk');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadBarangKeluarData() {
            showLoading(true);
            
            try {
                const { data: barangKeluar, error } = await supabase
                    .from('barang_keluar')
                    .select('*')
                    .order('tanggal_keluar', { ascending: false });
                
                const tbody = document.querySelector('#tableBarangKeluar tbody');
                tbody.innerHTML = '';
                
                if (barangKeluar && barangKeluar.length > 0) {
                    for (const item of barangKeluar) {
                        // Ambil info produk
                        const { data: produkData } = await supabase
                            .from('produk')
                            .select('nama_produk')
                            .eq('id', item.produk_id)
                            .single();
                        
                        const tanggal = new Date(item.tanggal_keluar).toLocaleDateString('id-ID');
                        const namaProduk = produkData ? produkData.nama_produk : 'Unknown';
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${tanggal}</td>
                            <td>${namaProduk}</td>
                            <td>${item.jumlah_unit_kecil}</td>
                            <td>${item.tujuan || '-'}</td>
                            <td>${item.catatan || '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-danger" onclick="hapusBarangKeluar(${item.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">Belum ada data barang keluar</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading outgoing goods data:', error);
                alert('Terjadi kesalahan saat memuat data barang keluar');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadProdukOptions() {
            try {
                const { data, error } = await supabase
                    .from('produk')
                    .select('id, nama_produk, sku')
                    .order('nama_produk');
                
                const selectMasuk = document.getElementById('produkMasuk');
                const selectKeluar = document.getElementById('produkKeluar');
                
                selectMasuk.innerHTML = '<option value="">Pilih Produk</option>';
                selectKeluar.innerHTML = '<option value="">Pilih Produk</option>';
                
                if (data && data.length > 0) {
                    data.forEach(item => {
                        const optionMasuk = document.createElement('option');
                        optionMasuk.value = item.id;
                        optionMasup.textContent = `${item.nama_produk} (${item.sku})`;
                        
                        const optionKeluar = document.createElement('option');
                        optionKeluar.value = item.id;
                        optionKeluar.textContent = `${item.nama_produk} (${item.sku})`;
                        
                        selectMasuk.appendChild(optionMasuk);
                        selectKeluar.appendChild(optionKeluar);
                    });
                }
            } catch (error) {
                console.error('Error loading product options:', error);
            }
        }
        
        async function updateStokInfo() {
            const produkId = document.getElementById('produkKeluar').value;
            
            if (!produkId) {
                document.getElementById('stokTersedia').textContent = '0';
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('stok_saat_ini_pcs')
                    .select('stok_total_pcs')
                    .eq('produk_id', produkId)
                    .single();
                
                if (data) {
                    document.getElementById('stokTersedia').textContent = data.stok_total_pcs || 0;
                } else {
                    document.getElementById('stokTersedia').textContent = '0';
                }
            } catch (error) {
                console.error('Error loading stock info:', error);
            }
        }
        
        async function tambahProduk() {
            showLoading(true);
            
            const produkData = {
                nama_produk: document.getElementById('namaProduk').value,
                sku: document.getElementById('sku').value,
                deskripsi: document.getElementById('deskripsiProduk').value,
                unit_besar: document.getElementById('unitBesar').value,
                unit_kecil: document.getElementById('unitKecil').value,
                konversi_kecil: parseInt(document.getElementById('konversiKecil').value)
            };
            
            try {
                const { data, error } = await supabase
                    .from('produk')
                    .insert([produkData]);
                
                if (error) throw error;
                
                // Tutup modal dan reset form
                bootstrap.Modal.getInstance(document.getElementById('modalTambahProduk')).hide();
                document.getElementById('formTambahProduk').reset();
                
                // Refresh data
                if (currentPage === 'produk') {
                    loadProdukData();
                } else if (currentPage === 'dashboard') {
                    loadDashboardData();
                }
                
                // Refresh opsi produk
                loadProdukOptions();
                
                alert('Produk berhasil ditambahkan!');
            } catch (error) {
                console.error('Error adding product:', error);
                alert('Terjadi kesalahan saat menambahkan produk');
            } finally {
                showLoading(false);
            }
        }
        
        async function tambahBarangMasuk() {
            showLoading(true);
            
            const barangMasukData = {
                produk_id: parseInt(document.getElementById('produkMasuk').value),
                jumlah_unit_besar: parseInt(document.getElementById('jumlahUnitBesar').value),
                tanggal_masuk: document.getElementById('tanggalMasuk').value,
                sumber: document.getElementById('sumber').value || null,
                catatan: document.getElementById('catatanMasuk').value || null
            };
            
            try {
                const { data, error } = await supabase
                    .from('barang_masuk')
                    .insert([barangMasukData]);
                
                if (error) throw error;
                
                // Tutup modal dan reset form
                bootstrap.Modal.getInstance(document.getElementById('modalTambahBarangMasuk')).hide();
                document.getElementById('formTambahBarangMasuk').reset();
                
                // Refresh data
                if (currentPage === 'barang-masuk') {
                    loadBarangMasukData();
                } else if (currentPage === 'dashboard') {
                    loadDashboardData();
                }
                
                alert('Barang masuk berhasil dicatat!');
            } catch (error) {
                console.error('Error adding incoming goods:', error);
                alert('Terjadi kesalahan saat mencatat barang masuk');
            } finally {
                showLoading(false);
            }
        }
        
        async function tambahBarangKeluar() {
            showLoading(true);
            
            const barangKeluarData = {
                produk_id: parseInt(document.getElementById('produkKeluar').value),
                jumlah_unit_kecil: parseInt(document.getElementById('jumlahUnitKecil').value),
                tanggal_keluar: document.getElementById('tanggalKeluar').value,
                tujuan: document.getElementById('tujuan').value || null,
                catatan: document.getElementById('catatanKeluar').value || null
            };
            
            // Validasi stok
            const stokTersedia = parseInt(document.getElementById('stokTersedia').textContent);
            if (barangKeluarData.jumlah_unit_kecil > stokTersedia) {
                alert('Jumlah barang keluar melebihi stok tersedia!');
                showLoading(false);
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('barang_keluar')
                    .insert([barangKeluarData]);
                
                if (error) throw error;
                
                // Tutup modal dan reset form
                bootstrap.Modal.getInstance(document.getElementById('modalTambahBarangKeluar')).hide();
                document.getElementById('formTambahBarangKeluar').reset();
                
                // Refresh data
                if (currentPage === 'barang-keluar') {
                    loadBarangKeluarData();
                } else if (currentPage === 'dashboard') {
                    loadDashboardData();
                }
                
                alert('Barang keluar berhasil dicatat!');
            } catch (error) {
                console.error('Error adding outgoing goods:', error);
                alert('Terjadi kesalahan saat mencatat barang keluar');
            } finally {
                showLoading(false);
            }
        }
        
        async function generateLaporan() {
            showLoading(true);
            
            try {
                // Tentukan periode
                let startDate, endDate;
                const now = new Date();
                const periode = document.getElementById('laporanPeriode').value;
                
                switch(periode) {
                    case 'hari-ini':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                        break;
                    case 'minggu-ini':
                        const day = now.getDay();
                        const diff = now.getDate() - day + (day === 0 ? -6 : 1);
                        startDate = new Date(now.getFullYear(), now.getMonth(), diff);
                        endDate = new Date(now.getFullYear(), now.getMonth(), diff + 7);
                        break;
                    case 'bulan-ini':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                        break;
                    case 'tahun-ini':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        endDate = new Date(now.getFullYear() + 1, 0, 0);
                        break;
                    case 'custom':
                        startDate = new Date(document.getElementById('tanggalAwal').value);
                        endDate = new Date(document.getElementById('tanggalAkhir').value);
                        break;
                }
                
                // Format tanggal untuk query
                const startDateStr = startDate.toISOString().split('T')[0];
                const endDateStr = endDate.toISOString().split('T')[0];
                
                // Ambil data barang masuk
                const { data: barangMasuk, error: errorMasuk } = await supabase
                    .from('barang_masuk')
                    .select('*, produk(nama_produk)')
                    .gte('tanggal_masuk', startDateStr)
                    .lte('tanggal_masuk', endDateStr);
                
                // Ambil data barang keluar
                const { data: barangKeluar, error: errorKeluar } = await supabase
                    .from('barang_keluar')
                    .select('*, produk(nama_produk)')
                    .gte('tanggal_keluar', startDateStr)
                    .lte('tanggal_keluar', endDateStr);
                
                // Hitung ringkasan
                let totalMasuk = 0;
                let totalKeluar = 0;
                
                if (barangMasuk) {
                    totalMasuk = barangMasuk.reduce((sum, item) => sum + (item.jumlah_unit_besar || 0), 0);
                }
                
                if (barangKeluar) {
                    totalKeluar = barangKeluar.reduce((sum, item) => sum + (item.jumlah_unit_kecil || 0), 0);
                }
                
                // Tampilkan ringkasan
                const ringkasanHTML = `
                    <div class="row">
                        <div class="col-6">
                            <p class="mb-1">Periode: ${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}</p>
                            <p class="mb-1">Total Barang Masuk: <strong>${totalMasuk} unit besar</strong></p>
                            <p class="mb-1">Total Barang Keluar: <strong>${totalKeluar} unit kecil</strong></p>
                            <p class="mb-0">Transaksi: <strong>${(barangMasuk?.length || 0) + (barangKeluar?.length || 0)}</strong></p>
                        </div>
                        <div class="col-6 text-end">
                            <button class="btn btn-sm btn-outline-primary" onclick="exportLaporan()">
                                <i class="fas fa-download me-2"></i> Export Laporan
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('ringkasanLaporan').innerHTML = ringkasanHTML;
                
                // Tampilkan produk dengan pergerakan tertinggi
                // (Implementasi sederhana - bisa dikembangkan lebih lanjut)
                const pergerakanHTML = `
                    <p>Fitur analisis pergerakan produk akan ditampilkan di sini.</p>
                    <p>Anda dapat mengembangkan fitur ini lebih lanjut untuk menampilkan:</p>
                    <ul>
                        <li>Produk dengan penjualan tertinggi</li>
                        <li>Produk dengan stok terendah</li>
                        <li>Grafik pergerakan stok</li>
                    </ul>
                `;
                
                document.getElementById('pergerakanProduk').innerHTML = pergerakanHTML;
                
            } catch (error) {
                console.error('Error generating report:', error);
                alert('Terjadi kesalahan saat membuat laporan');
            } finally {
                showLoading(false);
            }
        }
        
        function getStokStatus(stok) {
            if (stok >= 100) {
                return { class: 'stok-tinggi', text: 'Tinggi' };
            } else if (stok >= 20) {
                return { class: 'stok-sedang', text: 'Sedang' };
            } else {
                return { class: 'stok-rendah', text: 'Rendah' };
            }
        }
        
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }
        
        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                // Redirect ke halaman login atau lakukan logout
                window.location.href = 'login.html';
            }
        }
        
        // Fungsi untuk tombol aksi di tabel
        async function tambahBarangMasukForProduct(produkId) {
            document.getElementById('produkMasuk').value = produkId;
            showModal('modalTambahBarangMasuk');
        }
        
        async function editProduk(id) {
            // Implementasi edit produk
            alert('Fitur edit produk akan segera tersedia');
        }
        
        async function hapusProduk(id) {
            if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                showLoading(true);
                
                try {
                    const { error } = await supabase
                        .from('produk')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    loadProdukData();
                    loadProdukOptions();
                    alert('Produk berhasil dihapus');
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('Terjadi kesalahan saat menghapus produk');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        async function hapusBarangMasuk(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data barang masuk ini?')) {
                showLoading(true);
                
                try {
                    const { error } = await supabase
                        .from('barang_masuk')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    loadBarangMasukData();
                    alert('Data barang masuk berhasil dihapus');
                } catch (error) {
                    console.error('Error deleting incoming goods:', error);
                    alert('Terjadi kesalahan saat menghapus data barang masuk');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        async function hapusBarangKeluar(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data barang keluar ini?')) {
                showLoading(true);
                
                try {
                    const { error } = await supabase
                        .from('barang_keluar')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    loadBarangKeluarData();
                    alert('Data barang keluar berhasil dihapus');
                } catch (error) {
                    console.error('Error deleting outgoing goods:', error);
                    alert('Terjadi kesalahan saat menghapus data barang keluar');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        function exportLaporan() {
            alert('Fitur export laporan akan segera tersedia');
            // Implementasi: Generate PDF atau Excel dari data laporan
        }
    </script>
</body>
</html>
